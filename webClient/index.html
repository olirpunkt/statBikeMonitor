<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta charset="utf-8">
  <title>StatBikeMonitor</title>
    <meta name="author" content="Oliver Roll">
    <script src='https://cdn.plot.ly/plotly-2.32.0.min.js'></script>
</head>

<body style="background-color: #cac7e4">

<p />
<p />
<div id='myDiv'><!-- Plotly chart will be drawn inside this DIV --></div>
<div style="overflow:scroll; width: 800px; height: 200px; border: solid; border-radius: 9px" id="display"></div>

<script>
  
    var sock = new WebSocket("ws://localhost:8088");  
    var display = document.getElementById("display")
    var oldRPM = 0;
  
    sock.onopen = function (event) {
      
      setTimeout(function () { sock.send('webdisplay connection succeeded'); }, 1000);
      display.innerHTML += "connection succeeded <br />";
    };
    sock.onmessage = function (event) {
      //console.log(event);
      //console.log(event.data);
      let jsonString = JSON.parse(event.data);
      console.log(jsonString);
      //display.innerHTML += event.data + "<br />"; 
      display.innerHTML += jsonString.rpm + "<br />";
      Plotly.update('myDiv', {value:jsonString.rpm, delta: {reference: oldRPM}});
      oldRPM = jsonString.rpm;
      //updateGaugeExt('demoGauge', 0, 150, event.data);
    }
  
    /*function myFunction(event) {
      
      if (event.keyCode == 13) {     
        var text = document.getElementById('eingabe').value;   
        if (text != "") {     
          
          sock.send(text);    
          display.innerHTML += "<strong>Me: </strong>" + text + "<br />";      
          document.getElementById('eingabe').value = "";     
        }
        else {
          console.log("empty string not sent")
        }
      }
    }
    function clearlog() {
      display.innerHTML = "";
    }*/

    var data = [
	{
		domain: { x: [0, 1], y: [0, 1] },
		value: 90,
		title: { text: "Speed" },
		type: "indicator",
		mode: "gauge+number+delta",
        gauge: {
            axis: {range: [null, 180]},
            steps: [ 
                { range: [0,100], color: "lightgray"}  ,
                { range: [100,180], color: "lightblue" }  
            ]
        }
	}
];
    var layout = { width: 600, height: 500, margin: { t: 0, b: 0 } };
    Plotly.newPlot('myDiv', data, layout);
  </script>

</body>
</html>